# issue.md

## 2024-XX-XX タイムラインオーバーレイ初期化エラー
- 現象: NodeEditorWindow の初期化時に `TimelineGridOverlay` に `set_column_units` が存在せず `AttributeError` が発生する。
- 原因: `TimelineGridOverlay` クラスでは列単位を設定するメソッド名が `set_units` のまま実装されており、ウィンドウ側の期待する `set_column_units` と不一致だった。
- 対応: `TimelineGridOverlay` に互換メソッド `set_column_units` を追加し、内部で既存の `set_units` を呼び出すことで例外を解消。

## 2025-XX-XX タイムライン背景描画の刷新
- 現象: タイムラインの列区切りと日付ラベルが個別のグラフィックスアイテムでオーバーレイ描画されており、背景色の変更要求に対応しづらかった。
- 原因: 背景やグリッド線を `QGraphicsRectItem` などのシーンアイテムで構成していたため、シーン全体の背景色を直接制御できず、描画コストも高かった。
- 対応: 背景のタイル生成を `QGraphicsView` の背景ブラシで描画する方式に改め、日付境界のグリッド線も同ブラシで統合的に描画するよう変更した。

## 2025-XX-XX ノードエディタ背景色変更が反映されない
- 現象: タイムライン背景色をカスタマイズしても表示が更新されず、ノードエディタ全体の背景が初期色のまま変化しない。
- 原因: 背景タイル生成のキャッシュ鍵にテーマ変更が含まれておらず、またテーマ変更時にレイヤへ再適用する手段がなかったため描画が再実行されなかった。
- 対応: テーマ更新用 API を追加し、背景色変更時にキャッシュを無効化してレイヤへ再適用し即時再描画するよう修正。

## 2025-XX-XX ノードエディタウィンドウの責務肥大化
- 現象: `NodeEditorWindow` にコンテンツブラウザ、インスペクタ、タイムライン整列ツールなど複数 UI 部品の生成・制御が集約され、クラスの責務が肥大化していた。
- 原因: ウィンドウカテゴリ内で部品ごとにモジュールを分離せず、全機能を単一クラスに実装していたため再利用性が低くなっていた。
- 対応: コンテンツブラウザとインスペクタ、整列ツールバーをそれぞれ専用の `QDockWidget`/`QToolBar` 実装へ切り出し、`NodeEditorWindow` はイベント仲介と状態管理に専念するよう再設計した。

## 2025-XX-XX タイムライン背景の縦軸化とスナップ刷新
- 現象: タイムライン背景が水平方向基準で実装されており、縦軸で日付スナップさせる要件に適合していなかった。
- 原因: 背景描画とスナップ制御が横方向（X 軸）固定のまま設計されており、縦方向の座標変換・ラベル配置・スナップ制御を切り替える仕組みが存在しなかった。
- 対応: タイムライン軸の方向を列挙型で管理し、背景描画・ラベル・今日マーカー・スナップ制御を縦方向へ再設計。ノードエディタでは縦軸を選択して背景とスナップが日付列に揃うよう更新した。

## 2025-XX-XX ノードエディタ背景縞模様の表示確認
- 現象: NodeGraph の既存グリッド描画と新しい縞模様背景が重複し、ノード幅に揃った境界線が視認できないとの報告があった。
- 対応: `NodeGraph` 初期化直後に背景タイルを生成し、標準ノード幅を基準とした縞模様ブラシを適用。既存グリッドは `GRID_DISPLAY_NONE` に変更して描画を一本化した。
- 確認: 本環境は GUI 出力が無効なためスクリーンショット取得は不可。生成されるタイルがノード幅単位で繰り返されること、パン／ズーム時も `QBrush` タイルが連続することをコードレビューで確認した。

## 2025-XX-XX ノードエディタからスナップ・日付表示機能を撤去
- 現象: タイムラインスナップと日付グリッドが不要になったため、エディタ上に不要な UI が残っていた。
- 原因: ノード配置を自由化する要件により、従来のスナップ制御および日付オーバーレイが設計上の負債となった。
- 対応: スナップ制御ロジックとタイムライン描画コンポーネント、関連ドメインモデルとテストを削除し、`NodeEditorWindow` をシンプルな NodeGraph ベースの構成に刷新した。

## 2025-XX-XX ノードエディタ起動時の `viewport` 属性エラー
- 現象: スタート画面からノードエディタを開くと `NodeGraphWidget` に `viewport` 属性が存在しないとの `AttributeError` で起動できない。
- 原因: 背景縞幅調整用の `StripeWidthDragController` へ `NodeGraphQt.NodeGraph.widget`（`QTabWidget`）を渡しており、内部で期待される `QGraphicsView` の `viewport()` メソッドが呼び出せなくなっていた。
- 対応: `NodeGraph` から `viewer()`（`QGraphicsView`）を取得してドラッグコントローラへ渡すよう修正し、縞幅ドラッグのイベントフィルタが適切なビューポートに対して動作するようにした。
